(function(){var e=[].indexOf||function(e){for(var o=0,t=this.length;t>o;o++)if(o in this&&this[o]===e)return o;return-1};angular.module("ngBlockEditor",[]).provider("BlockEditor",function(){var e,o,t;this.blockTypes={},this.editorTemplateUrl="ng-block-editor/editor.html",this.blockTemplateUrl="ng-block-editor/block.html",this.dragAndDropEnabled=!1,this.toolbar=[],this.messages={removeBlockConfirm:"Are you sure you want to remove this block?"};try{angular.module("angular-sortable-view"),this.dragAndDropEnabled=!0}catch(o){e=o,this.dragAndDropEnabled=!1}return this.registerBlockType=function(e,o){return o.type=e,this.blockTypes[e]=o},t=this,this.$get=["$injector","$log",function(e,o){return{editorTemplateUrl:t.editorTemplateUrl,blockTemplateUrl:t.blockTemplateUrl,blockTypes:t.blockTypes,dragAndDropEnabled:t.dragAndDropEnabled,toolbar:t.toolbar,getMessage:function(n,r,i){return null==t.messages[n]&&o.error("[ngBlockEditor] No message with _id "+n),_.isFunction(t.messages[n])||_.isArray(t.messages[n])?e.invoke(t.messages[n],{$editor:r,$block:i}):t.messages[n]}}}],this}).controller("BlockEditorEmbedController",["$scope","$timeout","$sce","$block",function(e,o,t,n){var r,i;return e.embeddables=[{provider:"youtube",displayName:"YouTube",regex:/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/},{provider:"soundcloud",displayName:"SoundCloud",regex:/https?:\/\/(soundcloud.com\/[a-zA-Z0-9\/_-]*)/}],e.data={url:"",isValid:!1,contentId:void 0},e.trustedConcat=function(){var e;return e=Array.prototype.slice.call(arguments),t.trustAsResourceUrl(e.join(""))},r=_.debounce(function(t){return o(function(){var o;return null==t?(delete n.content.provider,delete n.content.url,e.data.contentId=void 0,e.data.isValid=!1):(o=_.find(e.embeddables,function(e){return e.regex.test(t)}),o?(n.content.provider=o.provider,n.content.url=t,e.data.contentId=o.regex.exec(t)[1],e.data.isValid=!0,e.data.url=t):(delete n.content.provider,delete n.content.url,e.data.contentId=void 0,e.data.isValid=!1))})},500,{leading:!0,trailing:!1}),r(null!=(null!=(i=n.content)?i.url:void 0)?n.content.url:""),e.$watch("data.url",r)}]).config(["BlockEditorProvider",function(e){return e.registerBlockType("text",{icon:"glyphicon glyphicon-align-justify",displayName:"Text",editTemplate:"ng-block-editor/edit/text.html",previewTemplate:"ng-block-editor/preview/text.html"}),e.registerBlockType("link",{icon:"glyphicon glyphicon-link",displayName:"Link",editTemplate:"ng-block-editor/edit/link.html",previewTemplate:"ng-block-editor/preview/link.html"}),e.registerBlockType("embed",{icon:"glyphicon glyphicon-facetime-video",displayName:"Embed",editTemplate:"ng-block-editor/edit/embed.html",previewTemplate:"ng-block-editor/preview/embed.html",editController:"BlockEditorEmbedController",renderController:"BlockEditorEmbedController"}),e.toolbar=["text","link","embed"]}]).directive("beEditor",["BlockEditor",function(o){var t;return t=o.blockTypes,{restrict:"E",templateUrl:o.editorTemplateUrl,require:["beEditor","ngModel"],scope:{toolbar:"=",ngModel:"=ngModel",ngDisabled:"="},controller:["$scope",function(e){var o,t;return o={},t=function(){return _.each(e.blocks,function(o,t){return o.canMoveUp=t>0,o.canMoveDown=t<e.blocks.length-1})},this.addBlock=function(o){return e.blocks.push(o),t()},this.editBlock=function(e){return o[e.$$hashKey]=_.cloneDeep(e),e.editing=!0},this.submitBlockEdit=function(e){return e.saved=!0,e.editing=!1},this.rollbackBlockEdit=function(e){var t;return e.saved?(t=_.cloneDeep(o[e.$$hashKey]),_.forOwn(t,function(o,t){return e[t]=o}),_.forOwn(e,function(o,n){return _.has(t,n)?void 0:delete e[n]}),delete o[e],e.editing=!1):this.removeBlock(e)},this.removeBlock=function(o){return e.blocks=_.without(e.blocks,o),t()},this.moveUp=function(o){var n,r,i;return o.canMoveUp&&(r=_.indexOf(e.blocks,o),r>0)?(n=e.blocks[r],i=e.blocks[r-1],e.blocks.splice(r-1,2,n,i),t()):void 0},this.moveDown=function(o){var n,r,i;return o.canMoveDown&&(r=_.indexOf(e.blocks,o),r<e.blocks.length-1)?(n=e.blocks[r],i=e.blocks[r+1],e.blocks.splice(r,2,i,n),t()):void 0},this.isEditing=function(){return e.editing}}],link:function(n,r,i,l){var c,d,a,u;return a=l[0],u=l[1],c="be-editor-"+(new Date).getTime(),r.addClass("be-editor"),r.attr("id",c),n.editing=!1,u.$formatters.push(function(e){var o;return o=angular.copy(e||[]),_.each(o,function(e,t){return e.saved=!0,e.canMoveUp=t>0,e.canMoveDown=t<o.length-1}),n.blocks=o}),u.$parsers.push(function(e){var o;return o=_.map(e,function(e){return _.omit(e,["saved","editing","canMoveUp","canMoveDown"])})}),u.$isEmpty=function(e){return _.isArray(e)&&e.length>0},_.each(o.blockTypes,function(e){return e.validator?u.$validators[e.type]=function(o){return _(o).filter({kind:e.type}).map(e.validator).all()}:void 0}),d=n.toolbar||o.toolbar,n.blockTypes=_(t).filter(function(o){return function(){var t;return t=o.type,e.call(d,t)>=0}}).sortBy(function(e){return _.indexOf(d,e.type)}).value(),n.dragAndDropEnabled=o.dragAndDropEnabled,n.startAddingNewBlock=function(){return n.addingNewBlock=!0},n.cancelAddingNewBlock=function(){return n.addingNewBlock=!1},n.addNew=function(e){var o;return o={kind:e,content:{},saved:!1},a.addBlock(o),a.editBlock(o),n.addingNewBlock=!1},n.$watch("blocks",function(e){return u.$setViewValue(_.cloneDeep(e)),n.editing=_(e).chain().map("editing").some().value(),r.toggleClass("be-editor-editing",n.editing)},!0)}}}]).directive("beBlock",["$window","$log","$controller","BlockEditor",function(e,o,t,n){return{restrict:"E",templateUrl:n.blockTemplateUrl,require:"^beEditor",scope:{block:"=",editEnabled:"@edit"},link:function(r,i,l,c){var d,a;return i.addClass("be-block"),r.$editor=c,r.config=n.blockTypes[r.block.kind],r.config?(r.edit=function(){return c.editBlock(r.block)},r.remove=function(){return e.confirm(n.getMessage("removeBlockConfirm",c,r.block))?c.removeBlock(r.block):void 0},r.moveUp=function(){return c.moveUp(r.block)},r.moveDown=function(){return c.moveDown(r.block)},r.save=function(){return c.submitBlockEdit(r.block)},r.cancel=function(){return c.rollbackBlockEdit(r.block)},null!=r.config.editController?(a={$scope:r,$block:r.block,$editor:c},d=t(r.config.editController,a)):void 0):void o.error("[ngBlockEditor] Unknown block type: "+r.block.kind)}}}]).directive("beRender",function(){return{restrict:"EA",template:'<div be-render-block="block" ng-repeat="block in blocks"></div>',scope:{blocks:"=beRender"},link:function(e,o,t){return o.addClass("be-render")}}}).directive("beRenderBlock",["$log","$controller","BlockEditor",function(e,o,t){return{restrict:"EA",template:'<div ng-include="config.previewTemplate"></div>',scope:{block:"=beRenderBlock"},replace:!0,link:function(n,r,i){var l,c;return r.addClass("be-render-block"),n.config=t.blockTypes[n.block.kind],n.config?null!=n.config.renderController?(c={$scope:n,$block:n.block},l=o(n.config.renderController,c)):void 0:void e.error("[ngBlockEditor] Unknown block type: "+n.block.kind)}}}])}).call(this);
angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/block.html",'<div class="row be-block-edit" ng-show="block.editing"><div class="col-sm-12"><div ng-include="config.editTemplate"></div></div></div><div class="row be-block-preview" ng-hide="block.editing"><div class="col-sm-1" ng-show="$editor.dragAndDropEnabled"><i class="glyphicon glyphicon-menu-hamburger" sv-handle></i></div><div class="col-sm-9"><div ng-include="config.previewTemplate"></div></div><div class="be-block-toggles" ng-class="{\'col-sm-3\': ! $editor.dragAndDropEnabled, \'col-sm-2\': $editor.dragAndDropEnabled}" role="group" ng-show="editEnabled != \'false\'"><div class="btn-group"><a class="btn btn-default btn-xs" ng-if="! $editor.dragAndDropEnabled" href="" ng-click="moveUp()" ng-class="{\'be-block-toggle-disabled\': ! block.canMoveUp}"><i class="glyphicon glyphicon-arrow-up"></i></a> <a class="btn btn-default btn-xs" ng-if="! $editor.dragAndDropEnabled" href="" ng-click="moveDown()" ng-class="{\'be-block-toggle-disabled\': ! block.canMoveDown}"><i class="glyphicon glyphicon-arrow-down"></i></a> <a class="btn btn-default btn-xs" href="" ng-click="edit()"><i class="glyphicon glyphicon-pencil"></i></a> <a class="btn btn-danger btn-xs" href="" class="text-danger" ng-click="remove()"><i class="glyphicon glyphicon-remove"></i></a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/editor.html",'<div sv-root sv-part="blocks"><be-block block="block" ng-repeat="block in blocks" edit="{{ ! ngDisabled }}" sv-element></be-block><div class="be-toolbar"><div ng-hide="addingNewBlock"><a href="" class="btn btn-default" ng-click="startAddingNewBlock()" ng-hide="ngDisabled">Add a new block</a></div><div ng-show="addingNewBlock"><a ng-repeat="blockType in ::blockTypes" href="" class="btn btn-default btn-sm" role="button" ng-click="addNew(blockType.type)"><i ng-class="::blockType.icon" ng-show="::blockType.icon"></i> &nbsp;{{ ::blockType.displayName }}</a> <a href="" ng-click="cancelAddingNewBlock()">Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/embed.html",'<div ng-form="form" class="form-horizontal"><span>Supported services: <strong ng-repeat="e in embeddables">{{ e.displayName }}<span ng-show="! $last">,&nbsp;</span></strong></span><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" ng-model="data.url" class="form-control" required> <input type="hidden" ng-model="block.content.url" required><p class="help-block" ng-show="block.content.url && ! data.isValid">Could not find any service matching provided URL.</p></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="! data.isValid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/link.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Label</label><div class="col-sm-10"><input type="text" class="form-control" ng-model="block.content.label"></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" class="form-control" ng-model="block.content.url" required></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/text.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Text</label><div class="col-sm-10"><textarea class="form-control" ng-model="block.content.html" required></textarea></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed.html","<ng-include ng-if=\"data.isValid\" src=\"'ng-block-editor/preview/embed/' + block.content.provider + '.html'\"></ng-include>")}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/link.html",'<a href="{{ block.content.url }}" target="_blank">{{ block.content.label || block.content.url }}</a>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/text.html",'<div ng-bind-html="block.content.html"></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/soundcloud.html",'<iframe width="100%" height="450" scrolling="no" frameborder="no" src="{{ trustedConcat(\'https://w.soundcloud.com/player/?url=https://\', data.contentId, \'&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true\') }}"></iframe>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/youtube.html",'<iframe width="100%" height="450" src="{{ trustedConcat(\'https://www.youtube.com/embed/\', data.contentId) }}"></iframe>')}]);